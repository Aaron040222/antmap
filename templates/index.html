<!DOCTYPE html>
<html>
<head>
    <title>Ant Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" type="text/javascript"></script>
  <style>
    html, body, #map {
      height: 100%;
      padding: 0;
      margin: 0;
    }
  </style>
     <link href="{{ url_for('static', filename='./css/leaflet-measure-path.css') }}"rel="stylesheet">
    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet-editable@latest/src/Leaflet.Editable.js" ></script>
    <script src="{{ url_for('static', filename='./js/leaflet-measure-path.js') }}"></script>
</head>

<body>
    <div id="map"></div>
    <div style="position:absolute;top:50px;left:60px;z-index:999;">
   <button type="button" id="areameasure_btn">MeasureArea</button>
    </div>
    <div style="position:absolute;top:50px;left:170px;z-index:999;">
   <button type="button" id="distanceMeasure_btn">MeasureDistance</button>
    </div>
    <div style="position:absolute;top:50px;left:300px;z-index:999;">
   <button type="button" id="clear_btn">ClearALL</button>
    </div>

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <script>

        const LOCATION = {
          lat: 0,
          lng: 0,
        };
        const CENTER = [LOCATION.lat, LOCATION.lng];
        const DEFAULT_ZOOM = 2;
        var dark = L.tileLayer('https://api.maptiler.com/maps/toner/{z}/{x}/{y}.png?key=bEhZ3Ta8sXLzA4Uf89Nn',{
            attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
            noWrap: true,
            id: "dark"
        });

        var bright = L.tileLayer('https://api.maptiler.com/maps/bright/{z}/{x}/{y}.png?key=bEhZ3Ta8sXLzA4Uf89Nn',{
            attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
            noWrap: true,
            id: "bright"
        });

        var satellite = L.tileLayer('https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=bEhZ3Ta8sXLzA4Uf89Nn',{
            attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
            noWrap: true,
            id: "satellite"
        });

        var streets = L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=bEhZ3Ta8sXLzA4Uf89Nn',{
            attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
            noWrap: true,
            id: "streets"
        });

        var map = L.map('map',{
            center: [0,0],
            zoom: 5,
            layers:[dark, bright, streets, satellite]
        });
        
        var baselayers = {
            "Streets": streets,
            "Satellite Hybrid": satellite,
            "Dark": dark,
            "Bright": bright
        };
        L.control.layers(baselayers).addTo(map);
        map.fitWorld();

    getData();

    async function getData(){
        const response = await fetch('/load_data');
        const data = await response.json();

        for (item of data) {
            const circle = L.circle([item.lat, item.lng],{
                color:'red',
                fillColor: '#f03',
                fillOpacity:0.5,
                radius:item.abund_value*500
            }).addTo(map)
            const txt = `The name of the ant found here is ${item.accepted_name}; ${item.abund_value} specimens of this species were found here ${item.max_ma} million years ago.`;

            circle.bindPopup(txt)
        }
        console.log(data);
    }
    </script>
    <script src="{{ url_for('static', filename='./js/measure.js') }}"></script>
</body>
</html>